<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="apple-touch-icon" sizes="60x60" href="../../../static/img/CedarRoboticsLogo.jpg">
  <link rel="apple-touch-icon" sizes="57x57" href="../../../static/img/CedarRoboticsLogo.jpg">
  <link rel="apple-touch-icon" sizes="72x72" href="../../../static/img/CedarRoboticsLogo.jpg">
  <link rel="apple-touch-icon" sizes="76x76" href="../../../static/img/CedarRoboticsLogo.jpg">
  <link rel="apple-touch-icon" sizes="114x114" href="../../../static/img/CedarRoboticsLogo.jpg">
  <link rel="apple-touch-icon" sizes="120x120" href="../../../static/img/CedarRoboticsLogo.jpg">
  <link rel="apple-touch-icon" sizes="144x144" href="../../../static/img/CedarRoboticsLogo.jpg">
  <link rel="apple-touch-icon" sizes="152x152" href="../../../static/img/CedarRoboticsLogo.jpg">
  <link rel="apple-touch-icon" sizes="180x180" href="../../../static/img/CedarRoboticsLogo.jpg">
  <link rel="icon" type="image/png" sizes="192x192" href="../../../static/img/CedarRoboticsLogo.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="../../../static/img/CedarRoboticsLogo.jpg">
  <link rel="icon" type="image/png" sizes="96x96" href="../../../static/img/CedarRoboticsLogo.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="../../../static/img/CedarRoboticsLogo.jpg">
  <link rel="manifest" href="../../../static/manifest.json">
  <meta name="msapplication-TileColor" content="#000000">
  <meta name="msapplication-TileImage" content="../../../static/img/CedarRoboticsLogo.jpg">
  <meta name="theme-color" content="#000000">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="Caleb John">
  <link
    href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
    rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <script type="text/javascript" language="javascript" src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
  </script>
  <script type="text/javascript"
    src="https://cdn.datatables.net/v/bs4/jq-3.3.1/jszip-2.5.0/dt-1.10.20/b-1.6.1/b-colvis-1.6.1/b-flash-1.6.1/b-html5-1.6.1/b-print-1.6.1/kt-2.5.1/r-2.2.3/sc-2.0.1/datatables.min.js">
  </script>
  <script src="https://kit.fontawesome.com/80bbe0004b.js" crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
  <script type="text/javascript"
    src="https://cdn.datatables.net/v/bs4/jq-3.3.1/jszip-2.5.0/dt-1.10.20/b-1.6.1/b-colvis-1.6.1/b-flash-1.6.1/b-html5-1.6.1/r-2.2.3/sc-2.0.1/datatables.min.js">
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
  </script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
  </script>
  <title>Admin Panel</title>
  <script type="text/javascript" class="init">
    $(document).ready(function () {
      $('#billing-table').DataTable();
    });
  </script>
  <style>
    .StripeElement {
      background-color: white;
      height: 40px;
      padding: 10px 12px;
      border-radius: 4px;
      border: 1px solid transparent;
      box-shadow: 0 1px 3px 0 #e6ebf1;
      -webkit-transition: box-shadow 150ms ease;
      transition: box-shadow 150ms ease;
    }

    .StripeElement--focus {
      box-shadow: 0 1px 3px 0 #cfd7df;
    }

    .StripeElement--invalid {
      border-color: #fa755a;
    }

    .StripeElement--webkit-autofill {
      background-color: #fefde5 !important;
    }
  </style>
</head>

<body>
  <div class="container-fluid">

    <div class="row">
      <div class="col-lg-1"></div>

      <div class="col-lg-10">
        <br>
        <h2>{{restName}} Billing Panel <a href="admin-panel" class="button btn-lg"><i class="fas fa-home"></i></a></h2>
        <hr>


        <div class="text-center">
          <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" id="pills-services-tab" data-toggle="pill" href="#pills-services" role="tab"
                aria-controls="pills-services" aria-selected="true">Your Services</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="pills-transaction-tab" data-toggle="pill" href="#pills-transaction" role="tab"
                aria-controls="pills-transaction" aria-selected="false">Edit Transaction Fees</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="pills-invoice-tab" data-toggle="pill" href="#pills-invoice" role="tab"
                aria-controls="pills-invoice" aria-selected="false">Download Invoices</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="pills-location-tab" data-toggle="pill" href="#pills-location" role="tab"
                aria-controls="pills-location" aria-selected="false">Locations</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="pills-payment-tab" data-toggle="pill" href="#pills-payment" role="tab"
                aria-controls="pills-payment" aria-selected="false">Edit Payment Details</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://squareup.com/dashboard/" target="_blank">View Square Dashboard</a>
            </li>
          </ul>
        </div>

        <div class="tab-content" id="pills-tabContent">


          <div class="tab-pane fade show active" id="pills-services" role="tabpanel"
            aria-labelledby="pills-services-tab">
            <br>
            <h3>Bill Breakdown</h3>
            <h6>{{billing.lastBill}} to {{billing.nextBill}}</h6>
            <br>
            <h5>Server Fee {{"$%.2f"|format(billing.fees.all.base)}}</h5>
            <br>
            <h5>Kiosks</h5><br>

            {% for key_kiosk, kiosk_val in billing.fees.all.kiosk.items() %}
            {% for kiosk_val_val in kiosk_val.kiosks %}

            <h6>Kiosk ID {{kiosk_val_val}} </h6>
            <p>Group {{kiosk_val.group}}</p>
            <p>Kiosk Software Fee {{"$%.2f"|format(kiosk_val.base)}}</p>
            {% if kiosk_val.installment %}

            <p>Kiosk Hardware Installment Fee {{"$%.2f"|format(kiosk_val.fees - kiosk_val.base)}}</p>
            <p>{{kiosk_val.remaining}} of {{kiosk_val.term}} Payments Remaining</p><br>
            <p>Total {{"$%.2f"|format(kiosk_val.fees)}}</p>
            {% else %}
            <br>
            <p>Total {{"$%.2f"|format(kiosk_val.base)}}</p>
            {% endif %}
            <br><br>
            <hr>
            {% endfor %}
            {% endfor %}

            <h5>Transactions Fees</h5>
            <br>
            <h6>Transactions Processed: {{billing.fees.all.transactions.count}}</h6><br>
            <h6>Transaction Fees Billed: {{"$%.2f"|format(billing.fees.all.transactions.fees)}}</h6>
            <br>
            <hr>
            <h5>Subtotal {{"$%.2f"|format(total)}}</h5>
            <br>
            <h6>Tax {{"$%.2f"|format(total * taxRate)}}</h6>
            <br>
            <h4>Total {{"$%.2f"|format(total * (1+taxRate) )}}</h4>
            <br><br><br>

          </div>

          <div class="tab-pane fade" id="pills-location" role="tabpanel" aria-labelledby="pills-location-tab">

            <a class="btn btn-lg btn-success" href="add-location-sq">Add Location <i class="fas fa-plus"></i></a>
            <br><br>

            {% for key, val in billing.fees.locations.items() %}


            <br>
            <h4>Location: {{key|capitalize}}</h4><br>
            <h5>Transactions</h5>
            <h6>{{val.fees.transactions.count}} Transactions Processed</h6>
            <h6>Transaction Fees Billed: {{"$%.2f"|format(val.fees.transactions.fees)}}</h6>
            <br>
            <h5>Kiosks</h5>
            {% for key_kiosk, val_kiosk in billing.kiosks.items() %}

            {% if val_kiosk.loc == key %}

            {% if val_kiosk.active == 1 %}
            <h6 class="text-success">Active Kiosk: {{key_kiosk}}</h6>

            {% else %}

            <h6 class="text-danger">Inactive Kiosk: {{key_kiosk}}</h6>

            {% endif %}


            {% else %}

            <p></p>

            {% endif %}


            {% endfor %}
            <hr><br>
            <!-- <h6>Transactions Processed: {{billing.fees.all.transactions.count}}</h6><br> -->
            <!-- <h6>Transaction Fees Billed: {{"$%.2f"|format(billing.fees.all.transactions.fees)}}</h6> -->

            {% endfor %}


          </div>


          <div class="tab-pane fade" id="pills-payment" role="tabpanel" aria-labelledby="pills-payment-tab">
            <br>
            <h5>Current Card: {{cardBrand}} ending {{cardLast4}} </h5>
            <hr>
            <br>
            <h4>Change Payment Method</h4><br>


            <br>
            <script src="https://js.stripe.com/v3/"></script>
            <form action="changeCard" method="post" id="payment-form">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
              <div class="form-row">
                <label for="card-element">
                  Enter Card Info Below
                </label>
                <div id="card-element" class="w-100">
                  <!-- A Stripe Element will be inserted here. -->
                </div>

                <!-- Used to display form errors. -->
                <div id="card-errors" class="w-100" role="alert"></div>
              </div>
              <br><br>
              <button class="btn btn-lg btn-success">Change</button>
            </form>


          </div>


          <div class="tab-pane fade" id="pills-transaction" role="tabpanel" aria-labelledby="pills-transaction-tab">
            <br>
            <h4>Fee Details</h4><br>
            <h5>Total Fee: {{"$%.2f"|format(billing.totalFee)}}</h5><br>
            <h5>Current Split<h5>
                <h6>Customer Fee: {{"$%.2f"|format(billing.custFee)}}</h6>
                <h6>Restaurant Fee: {{"$%.2f"|format(billing.restFee)}}</h6>
                <br>
                <h5>Change Split</h5><br>
                <div class="row">
                  <div class="col-lg-6">
                    <div class="alert alert-primary" role="alert">
                      Note: You Will Still Be Billed The Total Fee Every For Every Order, The Form Below Will Change How
                      Much We Add To The Customer's Bill On Checkout
                    </div>
                  </div>
                </div>
                <hr>
                <form action="change-split" method='POST' id="change-split">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                  <h6 class="text-danger">0%/100% <input class="radio" type="radio" name="split" value="0.0" required>
                  </h6>
                  <p>
                    Customer Pays {{"$%.2f"|format(0)}} <br>
                    Restaurant Pays {{"$%.2f"|format(billing.totalFee)}} <br>
                  </p>
                  <br>
                  <h6 class="text-warning">10%/90% <input class="radio" type="radio" name="split" value="0.1" required>
                  </h6>
                  <p>
                    Customer Pays {{"$%.2f"|format(billing.totalFee * 0.1)}} <br>
                    Restaurant Pays {{"$%.2f"|format(billing.totalFee * 0.9)}} <br>
                  </p>
                  <br>
                  <h6 class="text-info">20%/80% <input class="radio" type="radio" name="split" value="0.2" required>
                  </h6>
                  <p>
                    Customer Pays {{"$%.2f"|format(billing.totalFee * 0.2)}} <br>
                    Restaurant Pays {{"$%.2f"|format(billing.totalFee * 0.8)}} <br>
                  </p>
                  <br>
                  <h6 class="text-primary">30%/70% <input class="radio" type="radio" name="split" value="0.3" required>
                  </h6>
                  <p>
                    Customer Pays {{"$%.2f"|format(billing.totalFee * 0.3)}} <br>
                    Restaurant Pays {{"$%.2f"|format(billing.totalFee * 0.7)}} <br>
                  </p>
                  <br>
                  <h6 class="text-secondary">40%/60% <input class="radio" type="radio" name="split" value="0.4"
                      required></h6>
                  <p>
                    Customer Pays {{"$%.2f"|format(billing.totalFee * 0.4)}} <br>
                    Restaurant Pays {{"$%.2f"|format(billing.totalFee * 0.6)}} <br>
                  </p>
                  <br>
                  <h6 class="text-success">50%/50% <input class="radio" type="radio" name="split" value="0.5" required>
                  </h6>
                  <p>
                    Customer Pays {{"$%.2f"|format(billing.totalFee * 0.5)}} <br>
                    Restaurant Pays {{"$%.2f"|format(billing.totalFee * 0.5)}} <br>
                  </p>
                  <br>
                  <h6 class="text-secondary">60%/40% <input class="radio" type="radio" name="split" value="0.6"
                      required></h6>
                  <p>
                    Customer Pays {{"$%.2f"|format(billing.totalFee * 0.6)}} <br>
                    Restaurant Pays {{"$%.2f"|format(billing.totalFee * 0.4)}} <br>
                  </p>
                  <br>
                  <h6 class="text-primary">70%/30% <input class="radio" type="radio" name="split" value="0.7" required>
                  </h6>
                  <p>
                    Customer Pays {{"$%.2f"|format(billing.totalFee * 0.7)}} <br>
                    Restaurant Pays {{"$%.2f"|format(billing.totalFee * 0.3)}} <br>
                  </p>
                  <br>
                  <h6 class="text-info">80%/20% <input class="radio" type="radio" name="split" value="0.8" required>
                  </h6>
                  <p>
                    Customer Pays {{"$%.2f"|format(billing.totalFee * 0.8)}} <br>
                    Restaurant Pays {{"$%.2f"|format(billing.totalFee * 0.2)}} <br>
                  </p>
                  <br>
                  <h6 class="text-warning">90%/10% <input class="radio" type="radio" name="split" value="0.9" required>
                  </h6>
                  <p>
                    Customer Pays {{"$%.2f"|format(billing.totalFee * 0.9)}} <br>
                    Restaurant Pays {{"$%.2f"|format(billing.totalFee * 0.1)}} <br>
                  </p>
                  <br>
                  <h6 class="text-danger">100%/0% <input class="radio" type="radio" name="split" value="1.0" required>
                  </h6>
                  <p>
                    Customer Pays {{"$%.2f"|format(billing.totalFee)}} <br>
                    Restaurant Pays {{"$%.2f"|format(0)}} <br>
                  </p>
                  <br>
                  <br>
                  <button class="btn btn-lg btn-success" type="submit" form="change-split">Change</button>
                </form>

          </div>

          <div class="tab-pane fade" id="pills-invoice" role="tabpanel" aria-labelledby="pills-invoice-tab">
            <br>
            <h3>Download Invoices</h3>
            <hr>
            <br>
            {% if billing.bills %}
            {% for bill_key, bill_val in billing.bills.items() %}

            <a href="donwloadinvoice-{{bill_key}}">
              <h4>{{bill_val.startdate}} to {{bill_val.date}} <i class="fas fa-file-download"></i></h4><a><br>


                {% endfor %}
                {% else %}
                <h4>No Invoices have beeen generated at this time, please check back after your first billing cycle is
                  complete</h4>
                {% endif %}
          </div>






        </div>




        <br><br>
        <br><br>
        <br><br>

      </div>
    </div>

    <div class="col-lg-1"></div>

  </div>




  <script nonce="">
    var stripe = Stripe('pk_live_435TX7xzJrZEttNpHvd2FM4B009nas4OGm')
    // Create a Stripe client.
    var elements = stripe.elements();

    // Custom styling can be passed to options when creating an Element.
    // (Note that this demo uses a wider set of styles than the guide below.)
    var style = {
      base: {
        color: '#32325d',
        lineHeight: '18px',
        fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
        fontSmoothing: 'antialiased',
        fontSize: '16px',
        '::placeholder': {
          color: '#aab7c4'
        }
      },
      invalid: {
        color: '#fa755a',
        iconColor: '#fa755a'
      }
    };

    // Create an instance of the card Element.
    var card = elements.create('card', {
      style: style
    });

    // Add an instance of the card Element into the `card-element` <div>.
    card.mount('#card-element');

    // Handle real-time validation errors from the card Element.
    card.addEventListener('change', function (event) {
      var displayError = document.getElementById('card-errors');
      if (event.error) {
        displayError.textContent = event.error.message;
      } else {
        displayError.textContent = '';
      }
    });

    // Handle form submission.
    var form = document.getElementById('payment-form');
    form.addEventListener('submit', function (event) {
      event.preventDefault();

      stripe.createToken(card).then(function (result) {
        if (result.error) {
          // Inform the user if there was an error.
          var errorElement = document.getElementById('card-errors');
          errorElement.textContent = result.error.message;
        } else {
          // Send the token to your server.
          stripeTokenHandler(result.token);
        }
      });
    });

    // Submit the form with the token ID.
    function stripeTokenHandler(token) {
      // Insert the token ID into the form so it gets submitted to the server
      var form = document.getElementById('payment-form');
      var hiddenInput = document.createElement('input');
      hiddenInput.setAttribute('type', 'hidden');
      hiddenInput.setAttribute('name', 'stripeToken');
      hiddenInput.setAttribute('value', token.id);
      form.appendChild(hiddenInput);

      // Submit the form
      form.submit();
    }
  </script>
</body>

</html>